# 数据库初始化说明

## 概述

本项目提供了两种方式来初始化数据库：

1. **Go 程序方式**（推荐）
2. **SQL 脚本方式**（备用）

## 方式一：Go 程序初始化（推荐）

### 前提条件

- Go 环境正常
- MySQL 数据库已启动
- 配置文件 `configs/local.yaml` 已正确配置

### 运行步骤

1. 确保在 `backend` 目录下
2. 运行以下命令之一：

```bash
# 方式1：直接运行
go run cmd/init_db.go

# 方式2：使用批处理脚本（Windows）
run_init.bat

# 方式3：编译后运行
go build cmd/init_db.go
./init_db.exe
```

### 预期输出

```
=== 数据库初始化程序 ===
1. 加载配置文件...
✅ 配置加载成功
2. 初始化数据库连接...
✅ 数据库连接成功
3. 开始初始化数据库数据...
✅ 数据库初始化完成！

=== 测试账号信息 ===

📚 教师账号：
   用户名: 13800138001  密码: 123456  姓名: 张教授
   用户名: 13800138002  密码: 123456  姓名: 李老师
   用户名: 13800138003  密码: 123456  姓名: 王老师

🎓 学生账号：
   用户名: 20210001  密码: 123456  姓名: 张三
   用户名: 20210002  密码: 123456  姓名: 李四
   用户名: 20210003  密码: 123456  姓名: 王五
   用户名: 20210004  密码: 123456  姓名: 赵六
   用户名: 20210005  密码: 123456  姓名: 钱七
   用户名: 20210006  密码: 123456  姓名: 孙八
   用户名: 20210007  密码: 123456  姓名: 周九
   用户名: 20210008  密码: 123456  姓名: 吴十

📝 已创建测试任务和部分提交记录

=== 初始化完成 ===
```

## 方式二：SQL 脚本初始化（备用）

### 前提条件

- MySQL 数据库已启动
- 数据库已创建
- 有数据库访问权限

### 运行步骤

1. 连接到 MySQL 数据库
2. 执行 SQL 脚本：

```sql
-- 方式1：在MySQL命令行中执行
source scripts/init_database.sql

-- 方式2：复制脚本内容到MySQL客户端执行
```

### 脚本内容

SQL 脚本位于 `scripts/init_database.sql`，包含：

- 创建所有必要的表
- 插入测试用户数据
- 插入测试任务数据
- 插入测试提交数据

## 测试账号信息

### 教师账号

| 用户名      | 密码   | 姓名   | 部门                 |
| ----------- | ------ | ------ | -------------------- |
| 13800138001 | 123456 | 张教授 | 计算机科学与技术学院 |
| 13800138002 | 123456 | 李老师 | 软件工程学院         |
| 13800138003 | 123456 | 王老师 | 计算机科学与技术学院 |

### 学生账号

| 用户名   | 密码   | 姓名 | 专业             | 班级         |
| -------- | ------ | ---- | ---------------- | ------------ |
| 20210001 | 123456 | 张三 | 计算机科学与技术 | 计科 2101 班 |
| 20210002 | 123456 | 李四 | 计算机科学与技术 | 计科 2101 班 |
| 20210003 | 123456 | 王五 | 计算机科学与技术 | 计科 2101 班 |
| 20210004 | 123456 | 赵六 | 软件工程         | 软工 2101 班 |
| 20210005 | 123456 | 钱七 | 软件工程         | 软工 2101 班 |
| 20210006 | 123456 | 孙八 | 计算机科学与技术 | 计科 2102 班 |
| 20210007 | 123456 | 周九 | 计算机科学与技术 | 计科 2102 班 |
| 20210008 | 123456 | 吴十 | 软件工程         | 软工 2102 班 |

## 测试任务

1. **期末论文提交** - 张教授发布
2. **数据分析报告** - 李老师发布
3. **实验照片提交** - 王老师发布
4. **程序设计作业** - 张教授发布

## 故障排除

### 常见问题

1. **Go 环境问题**

   - 错误：`package fmt is not in std`
   - 解决：重新安装 Go 或修复 GOROOT 环境变量

2. **数据库连接失败**

   - 检查配置文件中的数据库连接信息
   - 确保 MySQL 服务已启动
   - 检查数据库用户权限

3. **表已存在错误**

   - 程序会自动跳过已存在的数据
   - 如需重新初始化，请先清空数据库

4. **外键约束错误**
   - 程序已按正确顺序创建表
   - 如果仍有问题，请使用 SQL 脚本方式

### 联系支持

如果遇到其他问题，请检查：

1. 配置文件是否正确
2. 数据库服务是否正常
3. 网络连接是否正常
